<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src 'self' file:;">
  <title>LOGAN - Log Analyzer</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="lib/xterm.css">
  <script src="lib/xterm.js"></script>
  <script src="lib/xterm-addon-fit.js"></script>
  <script src="lib/marked.umd.js"></script>
</head>
<body>
  <div id="app">
    <!-- Title Bar (drag region) -->
    <div class="titlebar">
      <img src="assets/logo.png" alt="LOGAN" class="titlebar-logo" id="logo" title="Open LOGAN on GitHub">
      <span class="titlebar-text">LOGAN</span>
      <div class="titlebar-spacer"></div>
      <div id="window-controls" class="window-controls hidden">
        <button id="btn-win-minimize" class="window-control-btn" title="Minimize">&#x2014;</button>
        <button id="btn-win-maximize" class="window-control-btn" title="Maximize">&#9633;</button>
        <button id="btn-win-close" class="window-control-btn close" title="Close">&#10005;</button>
      </div>
    </div>
    <!-- Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <button id="btn-open-file" class="toolbar-btn" title="Open file">
          <span class="icon">&#128194;</span> Open File
        </button>
        <div class="separator"></div>
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search..." class="toolbar-input">
          <label class="checkbox-label">
            <input type="checkbox" id="search-regex"> Regex
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="search-wildcard"> Wildcard
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="search-case"> Match Case
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="search-whole-word"> Whole Word
          </label>
          <button id="btn-search" class="toolbar-btn" title="Search">Search</button>
          <div class="search-options-wrapper">
            <button id="btn-search-options" class="toolbar-btn small" title="Search options">&#9881;</button>
            <div id="search-options-popup" class="search-options-popup hidden">
              <div class="search-option-row">
                <label class="search-option-label">Direction</label>
                <button id="search-direction" class="toolbar-btn small search-direction-btn" title="Toggle search direction">&#8595; Top to Bottom</button>
              </div>
              <div class="search-option-row">
                <label class="search-option-label" for="search-start-line">Start from line</label>
                <input type="number" id="search-start-line" class="search-start-line-input" placeholder="1" min="1">
              </div>
            </div>
          </div>
          <button id="btn-prev-result" class="toolbar-btn small" title="Previous result" disabled>&lt;</button>
          <span id="search-result-count" class="result-count"></span>
          <span id="search-engine-badge" class="search-engine-badge" title="Search engine"></span>
          <span id="hidden-matches-badge" class="hidden-matches-badge hidden" title="Click to see matches in filtered-out lines"></span>
          <button id="btn-next-result" class="toolbar-btn small" title="Next result" disabled>&gt;</button>
        </div>
        <div class="separator"></div>
        <button id="btn-filter" class="toolbar-btn" title="Filter settings">Filter</button>
        <button id="btn-split" class="toolbar-btn" title="Split file into parts" disabled>Split</button>
        <button id="btn-analyze" class="toolbar-btn" title="Analyze file" disabled>Analyze</button>
        <button id="btn-columns" class="toolbar-btn" title="Show/hide columns" disabled>Columns</button>
        <button id="btn-word-wrap" class="toolbar-btn" title="Toggle word wrap (⌥Z)">Wrap</button>
        <button id="btn-json-format" class="toolbar-btn" title="Format & highlight JSON in logs">JSON</button>
        <button id="btn-datadog" class="toolbar-btn" title="Connect to Datadog">DD</button>
      </div>
      <div class="toolbar-right">
        <button id="btn-notes-toggle" class="toolbar-btn small" title="Toggle Notes (Ctrl+Shift+N)">&#128221;</button>
        <button id="btn-terminal-toggle" class="toolbar-btn small" title="Toggle Terminal (Ctrl+`)">&#9000;</button>
        <button id="btn-help" class="toolbar-btn small" title="Keyboard shortcuts & help (F1)">&#9432;</button>
      </div>
    </div>

    <!-- Tab Bar -->
    <div id="tab-bar" class="tab-bar hidden">
      <div id="tabs-container" class="tabs-container"></div>
      <button id="btn-new-tab" class="tab-new-btn" title="Open new file">+</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Activity Bar -->
      <div id="activity-bar" class="activity-bar">
        <div class="activity-bar-top">
          <button class="activity-bar-btn" data-panel="folders" title="Folders (Ctrl+1)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
            <span class="activity-badge" id="badge-folders"></span>
          </button>
          <button class="activity-bar-btn" data-panel="stats" title="File Stats (Ctrl+2)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="18" y="3" width="4" height="18"></rect><rect x="10" y="8" width="4" height="13"></rect><rect x="2" y="13" width="4" height="8"></rect></svg>
            <span class="activity-badge" id="badge-stats"></span>
          </button>
          <button class="activity-bar-btn" data-panel="analysis" title="Analysis (Ctrl+3)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <span class="activity-badge" id="badge-analysis"></span>
          </button>
          <button class="activity-bar-btn" data-panel="time-gaps" title="Time Gaps (Ctrl+4)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="activity-badge" id="badge-time-gaps"></span>
          </button>
          <button class="activity-bar-btn" data-panel="bookmarks" title="Bookmarks (Ctrl+5)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
            <span class="activity-badge" id="badge-bookmarks"></span>
          </button>
          <button class="activity-bar-btn" data-panel="highlights" title="Highlights (Ctrl+6)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
            <span class="activity-badge" id="badge-highlights"></span>
          </button>
          <button class="activity-bar-btn" data-panel="history" title="History (Ctrl+7)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 8 14"></polyline><path d="M2.05 12A10 10 0 0 1 4.63 5.36"></path></svg>
            <span class="activity-badge" id="badge-history"></span>
          </button>
          <button class="activity-bar-btn" id="btn-search-configs" title="Search Configs (Ctrl+8)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line><line x1="11" y1="8" x2="11" y2="14"></line></svg>
            <span class="activity-badge" id="badge-search-configs"></span>
          </button>
          <button class="activity-bar-btn" id="btn-video-player" title="Video Player (Ctrl+9)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
            <span class="activity-badge" id="badge-video-player"></span>
          </button>
        </div>
        <div class="activity-bar-bottom">
          <button class="activity-bar-btn" id="btn-activity-settings" title="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
          </button>
        </div>
      </div>

      <!-- Panel Container -->
      <div id="panel-container" class="panel-container hidden">
        <!-- Panel Header -->
        <div class="panel-header">
          <span id="panel-title" class="panel-title">Folders</span>
          <div class="panel-header-actions">
            <button id="btn-pin-panel" class="panel-header-btn" title="Pin this panel (always visible)">&#128204;</button>
            <button id="btn-close-panel" class="panel-header-btn" title="Close panel">&times;</button>
          </div>
        </div>
        <!-- Panel Body -->
        <div class="panel-body">
          <!-- Folders Panel -->
          <div class="panel-view" id="panel-folders" data-panel="folders">
            <div class="section-header-inline">
              <button id="btn-refresh-folders" class="section-btn" title="Refresh folders">&#8635;</button>
              <button id="btn-add-folder" class="section-btn" title="Open folder">+</button>
            </div>
            <div class="folder-search-container">
              <input type="text" id="folder-search-input" class="folder-search-input" placeholder="Search in folders..." disabled>
              <button id="btn-folder-search" class="folder-search-btn" title="Search" disabled>&#128269;</button>
              <button id="btn-folder-search-cancel" class="folder-search-btn hidden" title="Cancel">&#10005;</button>
            </div>
            <div id="folder-search-results" class="folder-search-results hidden"></div>
            <div id="folders-list" class="folders-content">
              <p class="placeholder">No folders open</p>
            </div>
          </div>

          <!-- Stats Panel -->
          <div class="panel-view" id="panel-stats" data-panel="stats">
            <div id="file-stats" class="stats-content">
              <p class="placeholder">No file loaded</p>
            </div>
          </div>

          <!-- Analysis Panel (includes duplicates) -->
          <div class="panel-view" id="panel-analysis" data-panel="analysis">
            <div id="analysis-results" class="analysis-content">
              <p class="placeholder">Run analysis to see results</p>
            </div>
            <div class="panel-sub-section">
              <div class="panel-sub-header">Duplicates</div>
              <div id="duplicates-list" class="duplicates-content">
                <p class="placeholder">No duplicates found</p>
              </div>
            </div>
          </div>

          <!-- Time Gaps Panel -->
          <div class="panel-view" id="panel-time-gaps" data-panel="time-gaps">
            <div class="time-gap-controls">
              <label class="time-gap-label">
                Threshold:
                <input type="number" id="time-gap-threshold" class="time-gap-input" value="30" min="1"> sec
              </label>
              <button id="btn-detect-gaps" class="secondary-btn small">Detect</button>
              <button id="btn-cancel-gaps" class="secondary-btn small danger hidden">Cancel</button>
              <button id="btn-clear-gaps" class="secondary-btn small">Clear</button>
            </div>
            <div id="time-gap-nav" class="nav-controls hidden">
              <button id="btn-prev-gap" class="nav-btn" title="Previous gap">&#9664;</button>
              <span id="gap-nav-position" class="nav-position">0/0</span>
              <button id="btn-next-gap" class="nav-btn" title="Next gap">&#9654;</button>
            </div>
            <div class="time-gap-range">
              <div class="range-row">
                <label class="range-label">Lines:</label>
                <input type="number" id="time-gap-start-line" class="range-input" placeholder="Start" min="1">
                <span class="range-separator">-</span>
                <input type="number" id="time-gap-end-line" class="range-input" placeholder="End" min="1">
              </div>
              <div class="range-row">
                <label class="range-label">Between:</label>
                <input type="text" id="time-gap-start-pattern" class="range-pattern-input" placeholder="Start pattern (e.g. 10:00:00)">
              </div>
              <div class="range-row">
                <label class="range-label">and:</label>
                <input type="text" id="time-gap-end-pattern" class="range-pattern-input" placeholder="End pattern (e.g. 11:00:00)">
              </div>
            </div>
            <div id="time-gaps-list" class="time-gaps-content">
              <p class="placeholder">Click Detect to find time gaps</p>
            </div>
          </div>

          <!-- Bookmarks Panel -->
          <div class="panel-view" id="panel-bookmarks" data-panel="bookmarks">
            <div class="section-header-inline">
              <button id="btn-save-bookmark-set" class="icon-btn" title="Save as Bookmark Set">&#128230;</button>
              <button id="btn-load-bookmark-set" class="icon-btn" title="Load Bookmark Set">&#128229;</button>
              <button id="btn-export-bookmarks" class="icon-btn" title="Export Bookmarks">&#128190;</button>
            </div>
            <div id="bookmark-sets-bar" class="bookmark-sets-bar hidden">
              <div id="bookmark-sets-list" class="bookmark-sets-list"></div>
            </div>
            <div id="bookmarks-list" class="bookmarks-content">
              <p class="placeholder">No bookmarks</p>
            </div>
          </div>

          <!-- Highlights Panel -->
          <div class="panel-view" id="panel-highlights" data-panel="highlights">
            <div id="highlight-groups-bar" class="highlight-groups-bar">
              <div id="highlight-groups-chips" class="highlight-groups-chips"></div>
              <div class="highlight-groups-actions">
                <button id="btn-save-highlight-group" class="highlight-group-btn" title="Save current highlights as a group">Save</button>
                <button id="btn-delete-highlight-group" class="highlight-group-btn danger" title="Delete active group" style="display:none">Del</button>
              </div>
            </div>
            <div id="highlights-list" class="highlights-content">
              <p class="placeholder">No highlight rules</p>
            </div>
            <button id="btn-add-highlight" class="add-btn">+ Add Highlight Rule</button>
          </div>

          <!-- History Panel -->
          <div class="panel-view" id="panel-history" data-panel="history">
            <div class="section-header-inline">
              <select id="history-filter" class="history-filter-select">
                <option value="all">All Activity</option>
                <option value="search">Searches</option>
                <option value="filter">Filters</option>
                <option value="bookmark">Bookmarks</option>
                <option value="highlight">Highlights</option>
                <option value="analysis">Analysis</option>
                <option value="other">Other</option>
              </select>
              <button id="btn-clear-history" class="section-btn" title="Clear history">&#128465;</button>
            </div>
            <div id="history-list" class="history-content">
              <p class="placeholder">No activity recorded</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel Resize Handle -->
      <div id="panel-resize-handle" class="panel-resize-handle hidden"></div>

      <!-- Terminal Overlay (Quake-style drop-down) -->
      <div id="terminal-overlay" class="terminal-overlay hidden">
        <div id="terminal-panel" class="terminal-drop-panel">
          <div id="terminal-container" class="terminal-container"></div>
          <div id="terminal-resize-handle" class="terminal-resize-handle-bottom"></div>
        </div>
      </div>

      <!-- Hidden Matches Popup -->
      <div id="hidden-matches-popup" class="hidden-matches-popup hidden">
        <div class="hidden-matches-header">
          <span>Matches in filtered-out lines</span>
          <button id="btn-close-hidden-matches" class="hidden-matches-close">&times;</button>
        </div>
        <div id="hidden-matches-list" class="hidden-matches-list"></div>
      </div>

      <!-- Log Viewer -->
      <main class="log-viewer">
        <!-- Peek Preview Panel -->
        <div id="peek-preview" class="peek-preview hidden">
          <div class="peek-preview-header">
            <span id="peek-preview-title" class="peek-preview-title">Hidden Match Preview</span>
            <div class="peek-preview-actions">
              <button id="btn-peek-clear-filter" class="peek-action-btn" title="Clear filter and go to this line">Clear Filter &amp; Go To Line</button>
              <button id="btn-peek-close" class="peek-close-btn">&times;</button>
            </div>
          </div>
          <div id="peek-preview-content" class="peek-preview-content"></div>
        </div>
        <div id="long-lines-warning" class="long-lines-warning hidden">
          <span class="warning-icon">&#9888;</span>
          <span class="warning-text">This file has very long lines which may cause slow scrolling. Click <strong>JSON</strong> in the toolbar to reformat for better performance.</span>
          <button id="btn-format-warning" class="warning-action-btn">Format Now</button>
          <button id="btn-dismiss-warning" class="warning-close-btn">&times;</button>
        </div>
        <div id="editor-container" class="editor-container">
          <!-- Markdown Preview -->
          <div id="markdown-preview" class="markdown-preview hidden"></div>
          <div id="welcome-message" class="welcome-message">
            <img src="assets/logo.png" alt="LOGAN" class="welcome-logo">
            <h2>LOGAN</h2>
            <p>Log Analyzer - Open a log file to get started</p>
            <button id="btn-open-welcome" class="primary-btn">Open File</button>
          </div>
          <!-- Loading Overlay - inside editor so toolbar/tabs remain accessible -->
          <div id="loading-overlay" class="loading-overlay hidden">
            <video id="loading-video" autoplay loop muted playsinline>
              <source src="assets/loading.mp4" type="video/mp4">
            </video>
            <div class="loading-info">
              <span id="loading-text">Loading...</span>
              <div class="loading-progress-bar">
                <div id="loading-progress-fill" class="loading-progress-fill"></div>
              </div>
              <span id="loading-percent">0%</span>
              <span class="loading-hint">You can switch tabs or open other files while loading</span>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Notes Drawer (slide-up from bottom) -->
    <div id="notes-overlay" class="notes-overlay hidden">
      <div id="notes-drawer" class="notes-drawer">
        <div id="notes-resize-handle" class="notes-resize-handle-top"></div>
        <div class="notes-drawer-header">
          <span class="notes-title">Notes</span>
          <span id="notes-save-status" class="notes-save-status"></span>
          <button id="btn-notes-close" class="notes-close-btn" title="Close (Esc)">&times;</button>
        </div>
        <textarea id="notes-textarea" class="notes-textarea"
                  placeholder="Type your notes here... (auto-saved)"></textarea>
      </div>
    </div>

    <!-- Search Results Panel (slide-up from bottom) -->
    <div id="search-results-overlay" class="search-results-overlay hidden">
      <div id="search-results-panel" class="search-results-panel">
        <div id="search-results-resize-handle" class="search-results-resize-handle-top"></div>
        <div class="search-results-header">
          <span class="search-results-title">Search Results</span>
          <span id="search-results-summary" class="search-results-summary"></span>
          <button id="btn-search-results-close" class="search-results-close-btn" title="Close (Esc)">&times;</button>
        </div>
        <div id="search-results-list" class="search-results-list"></div>
      </div>
    </div>

    <!-- Search Configs Panel (slide-up from bottom) -->
    <div id="search-configs-overlay" class="search-configs-overlay hidden">
      <div id="search-configs-panel" class="search-configs-panel">
        <div id="search-configs-resize-handle" class="search-configs-resize-handle-top"></div>
        <div class="search-configs-header">
          <span class="search-configs-title">Search Configs</span>
          <span id="search-configs-summary" class="search-configs-summary"></span>
          <button id="btn-search-configs-close" class="search-configs-close-btn" title="Close (Esc)">&times;</button>
        </div>
        <div id="search-configs-chips" class="search-configs-chips">
          <button id="btn-add-search-config" class="search-config-add-btn" title="Add search config">+ Add</button>
        </div>
        <div id="search-configs-form" class="search-configs-form hidden">
          <input type="text" id="sc-pattern-input" class="sc-pattern-input" placeholder="Search pattern...">
          <div class="sc-form-toggles">
            <label class="sc-toggle-label"><input type="checkbox" id="sc-regex"> Regex</label>
            <label class="sc-toggle-label"><input type="checkbox" id="sc-match-case"> Case</label>
            <label class="sc-toggle-label"><input type="checkbox" id="sc-whole-word"> Word</label>
            <label class="sc-toggle-label" title="Global configs apply to all files"><input type="checkbox" id="sc-global"> Global</label>
          </div>
          <input type="color" id="sc-color-input" class="sc-color-input" value="#ffff00">
          <button id="btn-sc-save" class="sc-form-btn primary">Save</button>
          <button id="btn-sc-cancel" class="sc-form-btn">Cancel</button>
        </div>
        <div id="search-configs-results" class="search-configs-results"></div>
      </div>
    </div>

    <!-- Video Player Panel (slide-up from bottom) -->
    <div id="video-overlay" class="video-overlay hidden">
      <div id="video-panel" class="video-panel">
        <div id="video-resize-handle" class="video-resize-handle-top"></div>
        <div class="video-panel-header">
          <span class="video-panel-title">Video Player</span>
          <span id="video-file-name" class="video-file-name"></span>
          <button id="btn-video-close" class="video-close-btn" title="Close (Esc)">&times;</button>
        </div>
        <div class="video-panel-body">
          <div id="video-container" class="video-container">
            <video id="video-element" class="video-element" controls></video>
            <div id="video-drop-zone" class="video-drop-zone">
              <div class="video-drop-zone-content">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.5"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                <p>Drag & drop a video file here</p>
                <button id="btn-video-open" class="video-open-btn">Open Video</button>
              </div>
            </div>
          </div>
          <div class="video-sync-bar">
            <label class="video-sync-label">Sync:</label>
            <input type="text" id="video-sync-input" class="video-sync-input" placeholder="Timestamp at video 0:00" title="Enter the log timestamp that corresponds to video start (0:00)">
            <button id="btn-video-sync-from-line" class="video-sync-btn" title="Use selected line's timestamp">Set from line</button>
            <span id="video-sync-status" class="video-sync-status"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <footer class="status-bar">
      <div class="status-left">
        <span id="status-file">No file</span>
        <span class="status-separator">|</span>
        <span id="status-lines">0 lines</span>
        <span id="status-filtered" class="hidden">(<span id="filtered-count">0</span> filtered)</span>
      </div>
      <div class="status-center">
        <div id="progress-container" class="progress-container hidden">
          <div id="progress-bar" class="progress-bar"></div>
          <span id="progress-text" class="progress-text">0%</span>
        </div>
      </div>
      <div class="status-right">
        <span id="status-local-storage" class="status-local-storage hidden" title="Local .logan/ storage status"></span>
        <span id="status-cursor">Ln 1, Col 1</span>
        <span class="status-separator">|</span>
        <span id="status-size">0 B</span>
        <span class="status-separator">|</span>
        <span class="zoom-controls">
          <button id="btn-zoom-out" class="zoom-btn" title="Zoom Out (Ctrl+-)">−</button>
          <span id="status-zoom" title="Zoom level (Ctrl+0 to reset)">100%</span>
          <button id="btn-zoom-in" class="zoom-btn" title="Zoom In (Ctrl++)">+</button>
        </span>
      </div>
    </footer>

    <!-- Filter Modal -->
    <div id="filter-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Filter Settings</h3>
          <button class="modal-close" data-modal="filter-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label>Log Levels</label>
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" name="level" value="error" checked> Error</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="warning" checked> Warning</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="info" checked> Info</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="debug"> Debug</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="trace"> Trace</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="other" checked> Other</label>
            </div>
          </div>
          <div class="filter-group">
            <label for="include-patterns">Include Patterns (one per line)</label>
            <textarea id="include-patterns" class="filter-textarea" placeholder="e.g., error\nfailed"></textarea>
            <div class="context-lines-row">
              <label for="basic-context-lines">Context lines around matches:</label>
              <input type="number" id="basic-context-lines" class="context-lines-input" value="0" min="0" max="50">
            </div>
          </div>
          <div class="filter-group">
            <label for="exclude-patterns">Exclude Patterns (one per line)</label>
            <textarea id="exclude-patterns" class="filter-textarea" placeholder="e.g., heartbeat\nhealth"></textarea>
          </div>
          <div class="filter-group">
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="filter-match-case"> Match Case</label>
              <label class="checkbox-label"><input type="checkbox" id="filter-exact-match"> Exact Match</label>


            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-clear-filter" class="secondary-btn">Clear Filter</button>
          <button id="btn-advanced-filter" class="secondary-btn">Advanced</button>
          <button id="btn-apply-filter" class="primary-btn">Apply Filter</button>
        </div>
      </div>
    </div>

    <!-- Advanced Filter Modal -->
    <div id="advanced-filter-modal" class="modal hidden">
      <div class="modal-content advanced-filter-modal-content">
        <div class="modal-header">
          <h3>Advanced Filter</h3>
          <button class="modal-close" data-modal="advanced-filter-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="advanced-filter-description">
            Create complex filter expressions. Groups are combined with AND. Rules within a group use the group's operator (AND/OR).
          </div>
          <div id="filter-groups-container" class="filter-groups-container">
            <!-- Filter groups will be rendered here dynamically -->
          </div>
          <button id="btn-add-filter-group" class="add-btn">+ Add Group</button>

          <div class="filter-group" style="margin-top: 16px;">
            <label class="checkbox-label">
              <input type="checkbox" id="advanced-context-lines-enabled">
              Include context lines:
              <input type="number" id="advanced-context-lines" class="context-lines-input" value="3" min="0" max="50" disabled>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-clear-advanced-filter" class="secondary-btn">Clear</button>
          <button id="btn-cancel-advanced-filter" class="secondary-btn">Cancel</button>
          <button id="btn-apply-advanced-filter" class="primary-btn">Apply Filter</button>
        </div>
      </div>
    </div>

    <!-- Split Modal -->
    <div id="split-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Split File</h3>
          <button class="modal-close" data-modal="split-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label>Split Mode</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="split-mode" value="lines" checked> By lines per file
              </label>
              <label class="radio-label">
                <input type="radio" name="split-mode" value="parts"> By number of parts
              </label>
            </div>
          </div>
          <div class="filter-group">
            <label for="split-value">Value</label>
            <input type="number" id="split-value" class="modal-input" value="1000000" min="1">
            <span id="split-hint" class="hint">Lines per output file</span>
          </div>
          <div class="filter-group">
            <div id="split-preview" class="split-preview"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-cancel-split" class="secondary-btn">Cancel</button>
          <button id="btn-do-split" class="primary-btn">Split File</button>
        </div>
      </div>
    </div>

    <!-- Highlight Modal -->
    <div id="highlight-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add Highlight Rule</h3>
          <button class="modal-close" data-modal="highlight-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label for="highlight-pattern">Pattern</label>
            <input type="text" id="highlight-pattern" class="modal-input" placeholder="Enter pattern...">
          </div>
          <div class="filter-group">
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="highlight-regex"> Regex</label>
              <label class="checkbox-label"><input type="checkbox" id="highlight-case"> Match Case</label>
              <label class="checkbox-label"><input type="checkbox" id="highlight-whole-word"> Whole Word</label>
            </div>
          </div>
          <div class="filter-group">
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="highlight-include-whitespace"> Include Whitespace</label>
              <label class="checkbox-label"><input type="checkbox" id="highlight-all" checked> Highlight All Occurrences</label>
            </div>
          </div>
          <div class="filter-group">
            <div class="checkbox-group">
              <label class="checkbox-label" title="Global highlights apply to all files, local highlights only apply to this file">
                <input type="checkbox" id="highlight-global"> Global (apply to all files)
              </label>
            </div>
          </div>
          <div class="filter-group">
            <label for="highlight-bg-color">Background Color (auto-assigned)</label>
            <input type="color" id="highlight-bg-color" class="color-input" value="#ffff00">
          </div>
          <div class="filter-group">
            <label for="highlight-text-color">Text Color (optional)</label>
            <input type="color" id="highlight-text-color" class="color-input" value="#000000">
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-cancel-highlight" class="secondary-btn">Cancel</button>
          <button id="btn-save-highlight" class="primary-btn">Add Rule</button>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
      <div class="modal-content help-modal-content">
        <div class="modal-header">
          <h3>Keyboard Shortcuts & Tips</h3>
          <button class="modal-close" data-modal="help-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="help-section">
            <h4>File Operations</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>O</kbd><span>Open file</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>T</kbd><span>Open in new tab</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>W</kbd><span>Close current tab</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Tab</kbd><span>Next tab</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Tab</kbd><span>Previous tab</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Navigation & Search</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>F</kbd><span>Focus search</span></div>
              <div class="shortcut-item"><kbd>Enter</kbd><span>Search (when in search box)</span></div>
              <div class="shortcut-item"><kbd>F3</kbd> or <kbd>Ctrl</kbd>+<kbd>G</kbd><span>Next search result</span></div>
              <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>F3</kbd><span>Previous search result</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>PageDown</kbd><span>Next split file</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>PageUp</kbd><span>Previous split file</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Zoom</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>+</kbd><span>Zoom in</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>-</kbd><span>Zoom out</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>0</kbd><span>Reset zoom (100%)</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Scroll</kbd><span>Mouse wheel zoom</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Bookmarks & Highlights</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>B</kbd><span>Toggle bookmark on selected line</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>H</kbd><span>Highlight all occurrences of selection</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>H</kbd><span>Highlight single occurrence</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd><span>Save selected lines to file</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Terminal & Notes</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>`</kbd><span>Toggle terminal panel</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>N</kbd><span>Toggle notes drawer</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>R</kbd><span>Toggle search results panel</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>8</kbd><span>Toggle search configs panel</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>9</kbd><span>Toggle video player</span></div>
              <div class="shortcut-item"><kbd>Esc</kbd><span>Close terminal/notes/search results/search configs/video (when focused)</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Panels</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>1</kbd>...<kbd>7</kbd><span>Toggle panel (Folders/Stats/Analysis/Gaps/Bookmarks/Highlights/History)</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>\</kbd><span>Toggle panel visibility</span></div>
              <div class="shortcut-item"><kbd>Esc</kbd><span>Close panel (when focused)</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Other</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>F1</kbd><span>Show this help</span></div>
              <div class="shortcut-item"><kbd>Alt</kbd>+<kbd>Z</kbd><span>Toggle word wrap</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Tips</h4>
            <ul class="tips-list">
              <li><strong>Shift+Click</strong> to select a range of lines</li>
              <li><strong>Right-click</strong> for context menu (bookmark, copy, highlight)</li>
              <li><strong>Click minimap</strong> to jump to that position</li>
              <li><strong>Drag minimap viewport</strong> to scroll quickly</li>
              <li>Split large files using the <strong>Split</strong> button for better performance</li>
              <li>Binary/corrupted data is automatically detected and hidden</li>
            </ul>
          </div>
          <div class="help-section">
            <h4>Search Performance</h4>
            <p class="help-text" id="search-engine-info">Checking search engine...</p>
            <ul class="tips-list">
              <li><strong>ripgrep</strong> - 10-100x faster search (recommended)</li>
              <li>Install: <code>brew install ripgrep</code> (macOS) or <code>apt install ripgrep</code> (Linux)</li>
              <li>Falls back to stream-based search if ripgrep is not available</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <span class="version-info">LOGAN v0.1.4</span>
          <button id="btn-close-help" class="primary-btn">Got it!</button>
        </div>
      </div>
    </div>

    <!-- Columns Modal -->
    <div id="columns-modal" class="modal hidden">
      <div class="modal-content" style="width: 600px; max-height: 80vh;">
        <div class="modal-header">
          <h3>Column Visibility</h3>
          <button class="modal-close" data-modal="columns-modal">&times;</button>
        </div>
        <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
          <div id="columns-loading" class="placeholder">Analyzing columns...</div>
          <div id="columns-content" style="display: none;">
            <div class="filter-group">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span>Detected delimiter: <strong id="columns-delimiter"></strong></span>
                <div>
                  <button id="btn-columns-all" class="secondary-btn small">All</button>
                  <button id="btn-columns-none" class="secondary-btn small">None</button>
                </div>
              </div>
            </div>
            <div id="columns-list" class="columns-list"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-columns-cancel" class="secondary-btn">Cancel</button>
          <button id="btn-columns-apply" class="primary-btn">Apply</button>
        </div>
      </div>
    </div>

    <!-- Bookmark Comment Modal -->
    <div id="bookmark-modal" class="modal hidden">
      <div class="modal-content" style="width: 400px;">
        <div class="modal-header">
          <h3 id="bookmark-modal-title">Add Bookmark</h3>
          <button class="modal-close" data-modal="bookmark-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label for="bookmark-comment">Comment (optional)</label>
            <input type="text" id="bookmark-comment" class="modal-input" placeholder="Enter a comment for this bookmark...">
          </div>
          <div class="filter-group">
            <label>Color</label>
            <div id="bookmark-color-palette" class="bookmark-color-palette"></div>
          </div>
          <p id="bookmark-line-info" class="hint"></p>
        </div>
        <div class="modal-footer">
          <button id="btn-cancel-bookmark" class="secondary-btn">Cancel</button>
          <button id="btn-save-bookmark" class="primary-btn">Save</button>
        </div>
      </div>
    </div>

    <!-- Save Snippet Modal (save selected lines to file) -->
    <div id="notes-modal" class="modal hidden">
      <div class="modal-content" style="width: 500px;">
        <div class="modal-header">
          <h3>Save Snippet</h3>
          <button class="modal-close" data-modal="notes-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group" id="notes-file-group">
            <label>Snippet File</label>
            <div id="notes-file-options" class="radio-group">
              <!-- Will be populated dynamically -->
            </div>
          </div>
          <div class="filter-group">
            <label for="notes-description">Description (optional)</label>
            <input type="text" id="notes-description" class="modal-input" placeholder="e.g., Memory leak at startup, Connection timeout...">
          </div>
          <p id="notes-line-info" class="hint"></p>
        </div>
        <div class="modal-footer">
          <button id="btn-cancel-notes" class="secondary-btn">Cancel</button>
          <button id="btn-save-notes" class="primary-btn">Save Snippet</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-content" style="width: 400px;">
        <div class="modal-header">
          <h3>Settings</h3>
          <button class="modal-close" data-modal="settings-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="settings-group">
            <label for="theme-select">Theme</label>
            <select id="theme-select" class="settings-select">
              <option value="dark">Dark</option>
              <option value="paper">Paper (Eye Comfort)</option>
            </select>
          </div>
          <div class="settings-group">
            <label for="scroll-speed">Scroll Speed</label>
            <div class="slider-container">
              <input type="range" id="scroll-speed" min="10" max="100" value="30" class="settings-slider">
              <span id="scroll-speed-value" class="slider-value">30%</span>
            </div>
            <p class="hint">Adjusts trackpad scroll sensitivity (default: 30%)</p>
          </div>
          <div class="settings-group">
            <label for="default-font-size">Default Font Size</label>
            <div class="slider-container">
              <input type="range" id="default-font-size" min="10" max="20" value="13" class="settings-slider">
              <span id="default-font-size-value" class="slider-value">13px</span>
            </div>
          </div>
          <div class="settings-group">
            <label for="default-gap-threshold">Default Time Gap Threshold</label>
            <div class="slider-container">
              <input type="range" id="default-gap-threshold" min="1" max="60" value="5" class="settings-slider">
              <span id="default-gap-threshold-value" class="slider-value">5s</span>
            </div>
          </div>
          <div class="settings-group">
            <label class="checkbox-label">
              <input type="checkbox" id="auto-analyze"> Auto-analyze when opening files
            </label>
            <p class="hint">Automatically run analysis when a file is opened</p>
          </div>
          <div class="settings-group">
            <label>Sidebar Sections</label>
            <div class="settings-checkboxes" id="sidebar-section-toggles">
              <!-- Populated dynamically from renderer.ts -->
            </div>
            <p class="hint">Toggle visibility of sidebar sections</p>
          </div>
          <div class="settings-group" style="border-top: 1px solid var(--border-color); padding-top: 12px; margin-top: 12px;">
            <label>Datadog Integration</label>
            <div style="margin-top: 8px;">
              <label class="hint" for="dd-site-select">Site</label>
              <select id="dd-site-select" class="settings-select" style="margin-bottom: 8px;">
                <option value="US1">US1 (datadoghq.com)</option>
                <option value="US3">US3 (us3.datadoghq.com)</option>
                <option value="US5">US5 (us5.datadoghq.com)</option>
                <option value="EU1">EU1 (datadoghq.eu)</option>
                <option value="AP1">AP1 (ap1.datadoghq.com)</option>
              </select>
            </div>
            <div style="margin-top: 4px;">
              <label class="hint" for="dd-api-key">API Key</label>
              <input type="password" id="dd-api-key" class="modal-input" placeholder="Enter Datadog API key">
            </div>
            <div style="margin-top: 4px;">
              <label class="hint" for="dd-app-key">Application Key</label>
              <input type="password" id="dd-app-key" class="modal-input" placeholder="Enter Datadog Application key">
            </div>
            <div style="margin-top: 8px; display: flex; gap: 8px; align-items: center;">
              <button id="btn-dd-save-config" class="secondary-btn small">Save</button>
              <button id="btn-dd-clear-config" class="secondary-btn small">Clear</button>
              <span id="dd-config-status" class="hint" style="margin-left: 4px;"></span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-reset-settings" class="secondary-btn">Reset to Defaults</button>
          <button id="btn-close-settings" class="primary-btn">Close</button>
        </div>
      </div>
    </div>
    <!-- Datadog Query Modal -->
    <div id="datadog-modal" class="modal hidden">
      <div class="modal-content" style="width: 450px;">
        <div class="modal-header">
          <h3>Fetch Datadog Logs</h3>
          <button class="modal-close" data-modal="datadog-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label for="dd-query">Query</label>
            <input type="text" id="dd-query" class="modal-input" placeholder="*" value="*">
            <p class="hint">Datadog log search query syntax</p>
          </div>
          <div class="filter-group">
            <label for="dd-time-preset">Time Range</label>
            <select id="dd-time-preset" class="settings-select">
              <option value="15m">Last 15 minutes</option>
              <option value="1h" selected>Last 1 hour</option>
              <option value="4h">Last 4 hours</option>
              <option value="1d">Last 1 day</option>
              <option value="3d">Last 3 days</option>
              <option value="7d">Last 7 days</option>
              <option value="custom">Custom range</option>
            </select>
          </div>
          <div id="dd-custom-range" class="filter-group" style="display: none;">
            <label for="dd-from">From</label>
            <input type="datetime-local" id="dd-from" class="modal-input">
            <label for="dd-to" style="margin-top: 4px;">To</label>
            <input type="datetime-local" id="dd-to" class="modal-input">
          </div>
          <div class="filter-group">
            <label for="dd-max-logs">Max Logs</label>
            <input type="number" id="dd-max-logs" class="modal-input" value="5000" min="100" max="50000">
            <p class="hint">Maximum number of log entries to fetch (100-50,000)</p>
          </div>
          <div id="dd-fetch-status" class="hint" style="min-height: 20px; margin-top: 8px;"></div>
        </div>
        <div class="modal-footer">
          <button id="btn-dd-cancel" class="secondary-btn">Cancel</button>
          <button id="btn-dd-fetch" class="primary-btn">Fetch Logs</button>
        </div>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
