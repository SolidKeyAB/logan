<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src 'self';">
  <title>LOGAN - Log Analyzer</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <!-- Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <img src="assets/logo.png" alt="LOGAN" class="toolbar-logo" title="LOGAN - Log Analyzer">
        <div class="separator"></div>
        <button id="btn-open-file" class="toolbar-btn" title="Open file">
          <span class="icon">&#128194;</span> Open File
        </button>
        <div class="separator"></div>
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search..." class="toolbar-input">
          <label class="checkbox-label">
            <input type="checkbox" id="search-regex"> Regex
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="search-case"> Match Case
          </label>
          <button id="btn-search" class="toolbar-btn" title="Search">Search</button>
          <button id="btn-prev-result" class="toolbar-btn small" title="Previous result" disabled>&lt;</button>
          <span id="search-result-count" class="result-count"></span>
          <button id="btn-next-result" class="toolbar-btn small" title="Next result" disabled>&gt;</button>
        </div>
        <div class="separator"></div>
        <button id="btn-filter" class="toolbar-btn" title="Filter settings">Filter</button>
        <button id="btn-split" class="toolbar-btn" title="Split file into parts" disabled>Split</button>
        <button id="btn-analyze" class="toolbar-btn" title="Analyze file" disabled>Analyze</button>
      </div>
      <div class="toolbar-right">
        <button id="btn-help" class="toolbar-btn small" title="Keyboard shortcuts & help">?</button>
        <button id="btn-toggle-sidebar" class="toolbar-btn small" title="Toggle sidebar">&#9776;</button>
      </div>
    </div>

    <!-- Tab Bar -->
    <div id="tab-bar" class="tab-bar hidden">
      <div id="tabs-container" class="tabs-container"></div>
      <button id="btn-new-tab" class="tab-new-btn" title="Open new file">+</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Sidebar -->
      <aside id="sidebar" class="sidebar">
        <!-- File Stats Section -->
        <div class="sidebar-section" id="section-stats">
          <div class="section-header" data-section="stats">
            <span class="section-title">File Stats</span>
            <span class="section-toggle">&#9660;</span>
          </div>
          <div class="section-content">
            <div id="file-stats" class="stats-content">
              <p class="placeholder">No file loaded</p>
            </div>
          </div>
        </div>

        <!-- Analysis Results Section -->
        <div class="sidebar-section" id="section-analysis">
          <div class="section-header" data-section="analysis">
            <span class="section-title">Analysis</span>
            <span class="section-toggle">&#9660;</span>
          </div>
          <div class="section-content">
            <div id="analysis-results" class="analysis-content">
              <p class="placeholder">Run analysis to see results</p>
            </div>
          </div>
        </div>

        <!-- Patterns Section -->
        <div class="sidebar-section" id="section-patterns">
          <div class="section-header" data-section="patterns">
            <span class="section-title">Patterns</span>
            <span class="section-toggle">&#9660;</span>
          </div>
          <div class="section-content">
            <div id="patterns-list" class="patterns-content">
              <p class="placeholder">No patterns detected</p>
            </div>
          </div>
        </div>

        <!-- Duplicates Section -->
        <div class="sidebar-section" id="section-duplicates">
          <div class="section-header" data-section="duplicates">
            <span class="section-title">Duplicates</span>
            <span class="section-toggle">&#9660;</span>
          </div>
          <div class="section-content">
            <div id="duplicates-list" class="duplicates-content">
              <p class="placeholder">No duplicates found</p>
            </div>
          </div>
        </div>

        <!-- Bookmarks Section -->
        <div class="sidebar-section" id="section-bookmarks">
          <div class="section-header" data-section="bookmarks">
            <span class="section-title">Bookmarks</span>
            <span class="section-toggle">&#9660;</span>
          </div>
          <div class="section-content">
            <div id="bookmarks-list" class="bookmarks-content">
              <p class="placeholder">No bookmarks</p>
            </div>
          </div>
        </div>

        <!-- Highlights Section -->
        <div class="sidebar-section" id="section-highlights">
          <div class="section-header" data-section="highlights">
            <span class="section-title">Highlights</span>
            <span class="section-toggle">&#9660;</span>
          </div>
          <div class="section-content">
            <div id="highlights-list" class="highlights-content">
              <p class="placeholder">No highlight rules</p>
            </div>
            <button id="btn-add-highlight" class="add-btn">+ Add Highlight Rule</button>
          </div>
        </div>
      </aside>

      <!-- Log Viewer -->
      <main class="log-viewer">
        <div id="editor-container" class="editor-container">
          <div id="welcome-message" class="welcome-message">
            <img src="assets/logo.png" alt="LOGAN" class="welcome-logo">
            <h2>LOGAN</h2>
            <p>Log Analyzer - Open a log file to get started</p>
            <button id="btn-open-welcome" class="primary-btn">Open File</button>
          </div>
          <!-- Loading Overlay - inside editor so toolbar/tabs remain accessible -->
          <div id="loading-overlay" class="loading-overlay hidden">
            <video id="loading-video" autoplay loop muted playsinline>
              <source src="assets/loading.mp4" type="video/mp4">
            </video>
            <div class="loading-info">
              <span id="loading-text">Loading...</span>
              <div class="loading-progress-bar">
                <div id="loading-progress-fill" class="loading-progress-fill"></div>
              </div>
              <span id="loading-percent">0%</span>
              <span class="loading-hint">You can switch tabs or open other files while loading</span>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Status Bar -->
    <footer class="status-bar">
      <div class="status-left">
        <span id="status-file">No file</span>
        <span class="status-separator">|</span>
        <span id="status-lines">0 lines</span>
        <span id="status-filtered" class="hidden">(<span id="filtered-count">0</span> filtered)</span>
      </div>
      <div class="status-center">
        <div id="progress-container" class="progress-container hidden">
          <div id="progress-bar" class="progress-bar"></div>
          <span id="progress-text" class="progress-text">0%</span>
        </div>
      </div>
      <div class="status-right">
        <span id="status-cursor">Ln 1, Col 1</span>
        <span class="status-separator">|</span>
        <span id="status-size">0 B</span>
        <span class="status-separator">|</span>
        <span class="zoom-controls">
          <button id="btn-zoom-out" class="zoom-btn" title="Zoom Out (Ctrl+-)">âˆ’</button>
          <span id="status-zoom" title="Zoom level (Ctrl+0 to reset)">100%</span>
          <button id="btn-zoom-in" class="zoom-btn" title="Zoom In (Ctrl++)">+</button>
        </span>
      </div>
    </footer>

    <!-- Filter Modal -->
    <div id="filter-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Filter Settings</h3>
          <button class="modal-close" data-modal="filter-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label>Log Levels</label>
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" name="level" value="error" checked> Error</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="warning" checked> Warning</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="info" checked> Info</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="debug"> Debug</label>
              <label class="checkbox-label"><input type="checkbox" name="level" value="trace"> Trace</label>
            </div>
          </div>
          <div class="filter-group">
            <label for="include-patterns">Include Patterns (one per line)</label>
            <textarea id="include-patterns" class="filter-textarea" placeholder="e.g., error\nfailed"></textarea>
          </div>
          <div class="filter-group">
            <label for="exclude-patterns">Exclude Patterns (one per line)</label>
            <textarea id="exclude-patterns" class="filter-textarea" placeholder="e.g., heartbeat\nhealth"></textarea>
          </div>
          <div class="filter-group">
            <label class="checkbox-label">
              <input type="checkbox" id="collapse-duplicates"> Collapse duplicate lines
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-clear-filter" class="secondary-btn">Clear Filter</button>
          <button id="btn-apply-filter" class="primary-btn">Apply Filter</button>
        </div>
      </div>
    </div>

    <!-- Split Modal -->
    <div id="split-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Split File</h3>
          <button class="modal-close" data-modal="split-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label>Split Mode</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="split-mode" value="lines" checked> By lines per file
              </label>
              <label class="radio-label">
                <input type="radio" name="split-mode" value="parts"> By number of parts
              </label>
            </div>
          </div>
          <div class="filter-group">
            <label for="split-value">Value</label>
            <input type="number" id="split-value" class="modal-input" value="1000000" min="1">
            <span id="split-hint" class="hint">Lines per output file</span>
          </div>
          <div class="filter-group">
            <div id="split-preview" class="split-preview"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-cancel-split" class="secondary-btn">Cancel</button>
          <button id="btn-do-split" class="primary-btn">Split File</button>
        </div>
      </div>
    </div>

    <!-- Highlight Modal -->
    <div id="highlight-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add Highlight Rule</h3>
          <button class="modal-close" data-modal="highlight-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label for="highlight-pattern">Pattern</label>
            <input type="text" id="highlight-pattern" class="modal-input" placeholder="Enter pattern...">
          </div>
          <div class="filter-group">
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="highlight-regex"> Regex</label>
              <label class="checkbox-label"><input type="checkbox" id="highlight-case"> Match Case</label>
              <label class="checkbox-label"><input type="checkbox" id="highlight-whole-word"> Whole Word</label>
            </div>
          </div>
          <div class="filter-group">
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="highlight-include-whitespace"> Include Whitespace</label>
              <label class="checkbox-label"><input type="checkbox" id="highlight-all" checked> Highlight All Occurrences</label>
            </div>
          </div>
          <div class="filter-group">
            <div class="checkbox-group">
              <label class="checkbox-label" title="Global highlights apply to all files, local highlights only apply to this file">
                <input type="checkbox" id="highlight-global"> Global (apply to all files)
              </label>
            </div>
          </div>
          <div class="filter-group">
            <label for="highlight-bg-color">Background Color (auto-assigned)</label>
            <input type="color" id="highlight-bg-color" class="color-input" value="#ffff00">
          </div>
          <div class="filter-group">
            <label for="highlight-text-color">Text Color (optional)</label>
            <input type="color" id="highlight-text-color" class="color-input" value="#000000">
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-cancel-highlight" class="secondary-btn">Cancel</button>
          <button id="btn-save-highlight" class="primary-btn">Add Rule</button>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
      <div class="modal-content help-modal-content">
        <div class="modal-header">
          <h3>Keyboard Shortcuts & Tips</h3>
          <button class="modal-close" data-modal="help-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="help-section">
            <h4>File Operations</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>O</kbd><span>Open file</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>T</kbd><span>Open in new tab</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>W</kbd><span>Close current tab</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Tab</kbd><span>Next tab</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Tab</kbd><span>Previous tab</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Navigation & Search</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>F</kbd><span>Focus search</span></div>
              <div class="shortcut-item"><kbd>Enter</kbd><span>Search (when in search box)</span></div>
              <div class="shortcut-item"><kbd>F3</kbd> or <kbd>Ctrl</kbd>+<kbd>G</kbd><span>Next search result</span></div>
              <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>F3</kbd><span>Previous search result</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>PageDown</kbd><span>Next split file</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>PageUp</kbd><span>Previous split file</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Zoom</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>+</kbd><span>Zoom in</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>-</kbd><span>Zoom out</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>0</kbd><span>Reset zoom (100%)</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Scroll</kbd><span>Mouse wheel zoom</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Bookmarks & Highlights</h4>
            <div class="shortcut-list">
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>B</kbd><span>Toggle bookmark on selected line</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>H</kbd><span>Highlight all occurrences of selection</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>H</kbd><span>Highlight single occurrence</span></div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd><span>Save selected lines to file</span></div>
            </div>
          </div>
          <div class="help-section">
            <h4>Tips</h4>
            <ul class="tips-list">
              <li><strong>Shift+Click</strong> to select a range of lines</li>
              <li><strong>Right-click</strong> for context menu (bookmark, copy, highlight)</li>
              <li><strong>Click minimap</strong> to jump to that position</li>
              <li><strong>Drag minimap viewport</strong> to scroll quickly</li>
              <li>Split large files using the <strong>Split</strong> button for better performance</li>
              <li>Binary/corrupted data is automatically detected and hidden</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-close-help" class="primary-btn">Got it!</button>
        </div>
      </div>
    </div>

    <!-- Bookmark Comment Modal -->
    <div id="bookmark-modal" class="modal hidden">
      <div class="modal-content" style="width: 400px;">
        <div class="modal-header">
          <h3 id="bookmark-modal-title">Add Bookmark</h3>
          <button class="modal-close" data-modal="bookmark-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="filter-group">
            <label for="bookmark-comment">Comment (optional)</label>
            <input type="text" id="bookmark-comment" class="modal-input" placeholder="Enter a comment for this bookmark...">
          </div>
          <p id="bookmark-line-info" class="hint"></p>
        </div>
        <div class="modal-footer">
          <button id="btn-cancel-bookmark" class="secondary-btn">Cancel</button>
          <button id="btn-save-bookmark" class="primary-btn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
